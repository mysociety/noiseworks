{% extends "base.html" %}

{% block content %}
{% with request.session.merging_case as duplicate %}

{% if duplicate and case.id != duplicate.id %}
<div style="background-color: #ffe; padding: 1em 1em 0;">
<form action="{% url "case-merge" case.id %}" method="post">{% csrf_token %}
<input class="govuk-button" type="submit" name="dupe" value="Merge {{ duplicate.name }} into this case" id="edit-form-submit">
<input class="govuk-button govuk-button--secondary" type="submit" name="stop" value="Stop looking for duplicates">
</form>
</div>
{% endif %}

<p><a href="{% url "cases" %}">&lsaquo; Back to all cases</a></p>

<p class="case-id-badge">{{ case.id }}</p>
<h1 style="margin-top: 0">{{ case.kind_display }} at {{ case.location_display }}</h1>

<h2>Case info</h2>

<dl>
    <dt>Type
    <dd>{{ case.kind_display }}
    <dt>Created
    <dd>{{ case.created|timesince }}
    <dt>Last action
    <dd>{{ case.last_action.created|timesince }} - {{ case.last_action }}
    <dt>Assigned
    <dd>{{ case.assigned }}
    <a href="{% url 'case-reassign' case.id %}">Change</a>
</dl>

<a href="{% url "case-log-action" case.id %}" class="govuk-button">Log an action</a>
{% if not duplicate %}
<a href="{% url "case-merge" case.id %}" class="govuk-button govuk-button--secondary">Merge into another case</a>
{% endif %}

<h2>Noise source</h2>

{{ case.location_display }}
<br>House or shop? {{ case.get_where_display }}
<br>Hackney Estate? {{ case.get_estate_display }}

<h2>Timeline</h2>

<a href="{% url "case-log-action" case.id %}" class="govuk-button">Log an action</a>

<ul>
{% for entry in case.timeline %}
<li>{{ entry.summary }}
    <br>{{ entry.time }}
{% endfor %}
</ul>

{% endwith %}
{% endblock %}
