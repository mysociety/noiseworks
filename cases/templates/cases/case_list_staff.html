{% extends "base.html" %}
{% load crispy_forms_tags crispy_forms_gds %}

{% block content %}

<h1>Cases</h1>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third">
        <h2 class="govuk-visually-hidden">Filters</h2>

        <div class="case-filters">
        {% crispy filter.form %}
        </div>
    </div>
    <div class="govuk-grid-column-two-thirds">

      {% if qs %}
        {% include "cases/_pagination.html" %}
      {% endif %}

<ul class="nw-case-list">
{% for case in qs %}
    <li class="nw-case-list__item">
        <a href="{% url 'case-view' case.id %}" class="nw-case-list__header nw-link--no-visited-state">
            <span class="nw-tag--id">{{ case.id }}</span>
            <span class="case-list__title">{{ case.kind_display }} at {{ case.location_display }}</span>
        </a>
        <dl class="nw-summary-list govuk-summary-list--no-border">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Last action</dt>
                <dd class="govuk-summary-list__value">{% if case.last_action %}
                    {{ case.last_action.created }} &ndash; {{ case.last_action|truncatewords:10 }}
                {% else %}
                    {{ case.created }} &ndash; initial case submitted
                {% endif %}</dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Assigned</dt>
                <dd class="govuk-summary-list__value">{{ case.assigned|default:"No-one" }}</dd>
            </div>
        </dl>
    </li>
{% empty %}
  {% if filter.form.cleaned_data.assigned == "me" %}
    <li class="nw-case-list__empty">
        <p>There are no cases assigned to you.</p>
        <p><a class="nw-link--no-visited-state" href="{% url "cases" %}?assigned=none">Show unassigned cases</a>
        <p><a class="nw-link--no-visited-state" href="{% url "cases" %}?assigned=">Show all cases</a>
    </li>
  {% else %}
    <li><p>There are no cases to show.</p></li>
  {% endif %}
{% endfor %}
</ul>

      {% if qs %}
        {% include "cases/_pagination.html" %}
      {% endif %}

    </div>
</div>

{% endblock %}
